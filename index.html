<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Redactor HTML</title>
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <style>
           /* --- VARIABLES DE TEMA --- */
        :root {
            --primary: #3b82f6;
            --primary-hover: #2563eb;
            --bg-body: #f8fafc;
            --bg-panel: #ffffff;
            --bg-sidebar: #f1f5f9;
            --text-main: #0f172a;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --code-bg: #1e293b;
            --toast-bg: #0f172a;
            --toast-text: #ffffff;
            --input-placeholder: #94a3b8;
        }

        [data-theme="dark"] {
            --primary: #60a5fa;
            --primary-hover: #3b82f6;
            --bg-body: #020617;
            --bg-panel: #0f172a;
            --bg-sidebar: #1e293b;
            --text-main: #e2e8f0;
            --text-muted: #94a3b8;
            --border: #334155;
            --code-bg: #02040a;
            --toast-bg: #ffffff;
            --toast-text: #0f172a;
            --input-placeholder: #475569;
        }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; font-family: 'Inter', sans-serif;
            background: var(--bg-body); height: 100vh;
            color: var(--text-main); display: flex; overflow: hidden;
            transition: background 0.3s ease, color 0.3s ease;
        }

/* --- ESTILOS MÓVILES (APP LIKE) --- */

/* Por defecto, la barra móvil está oculta */
.mobile-nav { display: none; }

@media (max-width: 900px) {
    /* 1. Ajustes del Layout Principal */
    body {
        /* Espacio extra abajo para que la barra no tape el contenido */
        padding-bottom: 80px; 
    }
    
    .actions {
        display: none !important; /* Ocultamos los botones viejos de arriba en móvil */
    }

    /* 2. Barra de Navegación Inferior */
    .mobile-nav {
        display: flex;
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 65px;
        background: var(--bg-panel);
        border-top: 1px solid var(--border);
        box-shadow: 0 -5px 20px rgba(0,0,0,0.05);
        z-index: 999;
        justify-content: space-around; /* Distribuye espacio equitativamente */
        align-items: center;
        padding: 0 10px;
        backdrop-filter: blur(10px); /* Efecto cristal moderno */
    }

    /* Items de la barra */
    .nav-item {
        background: transparent;
        border: none;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: var(--text-muted);
        font-size: 0.7rem;
        gap: 4px;
        width: 60px;
        cursor: pointer;
        transition: 0.2s;
    }
    
    .nav-item i {
        font-size: 1.2rem;
        margin-bottom: 2px;
    }

    .nav-item:active {
        transform: scale(0.9);
        color: var(--primary);
    }

    /* 3. Botón Flotante Central (FAB) */
    .nav-fab-container {
        position: relative;
        top: -25px; /* Elevarlo sobre la barra */
        width: 60px;
        height: 60px;
    }

    .nav-fab {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: var(--primary);
        color: white;
        border: 4px solid var(--bg-body); /* Borde para simular recorte */
        font-size: 1.4rem;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 5px 15px rgba(37, 99, 235, 0.4);
        transition: transform 0.2s;
    }

    .nav-fab:active {
        transform: scale(0.95);
    }
    
    /* Ajuste para modo oscuro en el borde del FAB */
    [data-theme="dark"] .nav-fab {
        border-color: #0f172a; /* Debe coincidir con el fondo oscuro */
    }
}


/* --- ZONA DE PUBLICIDAD SIDEBAR --- */
.ad-zone-container {
    /* Se asegura que quede al final de la barra flex */
    margin-top: auto; 
    padding: 20px;
    border-top: 1px solid var(--border);
    background: var(--bg-body); /* Un tono diferente sutil para separar */
    flex-shrink: 0; /* Evita que se aplaste si falta espacio */
    display: flex;
    justify-content: center;
    align-items: center;
}

/* Estilo para el placeholder (borra esto cuando pongas un anuncio real) */
.ad-placeholder {
    width: 100%;
    max-width: 240px; /* Ancho estándar común */
    height: 240px;    /* Alto estándar común */
    background-color: #e2e8f0;
    border: 2px dashed #cbd5e1;
    border-radius: 8px;
    display: flex;
    justify-content: center;
    align-items: center;
    text-align: center;
    color: #64748b;
    font-size: 0.8rem;
    font-weight: 600;
    transition: 0.3s;
}

/* Adaptación al modo oscuro del placeholder */
[data-theme="dark"] .ad-zone-container {
    background: rgba(0,0,0,0.2);
}
[data-theme="dark"] .ad-placeholder {
    background-color: #1e293b;
    border-color: #334155;
    color: #94a3b8;
}

/* Ajuste Responsive: ocultar anuncio en móviles si la pantalla es muy corta */
@media (max-height: 600px) and (max-width: 900px) {
    .ad-zone-container { display: none; }
}



        /* --- TOASTS --- */
        #toast-container { position: fixed; bottom: 24px; right: 24px; z-index: 9999; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        .toast { background: var(--toast-bg); color: var(--toast-text); padding: 14px 24px; border-radius: 12px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 12px; min-width: 280px; animation: slideIn 0.3s forwards; font-size: 0.95rem; font-weight: 500; pointer-events: auto; border-left: 5px solid var(--primary); }
        .toast.error { border-left-color: #ef4444; }
        @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes fadeOut { to { transform: translateX(100%); opacity: 0; } }

        /* --- LAYOUT --- */
        .app-wrapper { display: flex; width: 100%; height: 100%; position: relative; }

        /* SIDEBAR */
        aside {
            width: 280px; background: var(--bg-sidebar); border-right: 1px solid var(--border);
            padding: 1.5rem; display: flex; flex-direction: column;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); z-index: 100;
        }

        .brand { font-size: 1.5rem; font-weight: 700; color: var(--primary); margin-bottom: 2rem; display: flex; align-items: center; gap: 10px; }

        .btn-new {
            background: var(--primary); color: white; border: none; padding: 12px;
            border-radius: 8px; font-weight: 600; cursor: pointer;
            display: flex; justify-content: center; gap: 8px; margin-bottom: 1rem;
            transition: background 0.2s;
        }
        .btn-new:hover { background: var(--primary-hover); }

        .file-list { list-style: none; padding: 0; margin: 0; overflow-y: auto; flex: 1; margin-bottom: 1rem; }
        .file-item {
            padding: 12px; margin-bottom: 8px; border-radius: 8px; cursor: pointer;
            display: flex; justify-content: space-between; align-items: center;
            color: var(--text-main); border: 1px solid transparent; transition: all 0.2s;
        }
        .file-item:hover { background: rgba(59, 130, 246, 0.1); }
        .file-item.active { background: rgba(59, 130, 246, 0.15); border-color: var(--primary); }
        .file-info strong { display: block; font-size: 0.9rem; margin-bottom: 2px; }
        .file-info small { color: var(--text-muted); font-size: 0.75rem; }
        .delete-btn { background: none; border: none; color: #ef4444; cursor: pointer; padding: 8px; opacity: 0.6; }
        .file-item:hover .delete-btn { opacity: 1; }

        /* NUEVA SECCIÓN DE BACKUP */
        .backup-section {
            border-top: 1px solid var(--border);
            padding-top: 1rem;
            display: flex;
            gap: 10px;
        }
        .btn-backup {
            flex: 1;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-main);
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            display: flex; flex-direction: column; align-items: center; gap: 5px;
            transition: all 0.2s;
        }
        .btn-backup:hover { background: rgba(0,0,0,0.05); border-color: var(--text-muted); }
        .btn-backup i { font-size: 1rem; color: var(--primary); }

        /* MAIN */
        main {
            flex: 1; display: flex; flex-direction: column;
            background: var(--bg-panel); position: relative; width: 100%;
        }

        .top-bar {
            padding: 10px 1.5rem; border-bottom: 1px solid var(--border);
            display: flex; align-items: center; gap: 1rem; background: var(--bg-panel); height: 65px;
        }

        .menu-toggle { display: none; background: none; border: none; font-size: 1.3rem; color: var(--text-main); cursor: pointer; padding: 5px; }

        input.doc-title { flex: 1; font-size: 1.1rem; font-weight: 600; border: none; background: transparent; color: var(--text-main); padding: 5px; min-width: 0; }
        input.doc-title::placeholder { color: var(--input-placeholder); font-weight: 400; }

        .actions-right { display: flex; gap: 8px; align-items: center; }
        
        .btn-icon {
            background: transparent; border: 1px solid var(--border);
            color: var(--text-main); width: 40px; height: 40px; border-radius: 8px;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: all 0.2s;
        }
        .btn-icon:hover { color: var(--primary); border-color: var(--primary); }

        .btn-save {
            background: var(--primary); color: white; border: none;
            padding: 0 16px; height: 40px; border-radius: 8px; font-weight: 500;
            cursor: pointer; display: flex; align-items: center; gap: 8px; white-space: nowrap;
        }
        .btn-save:hover { background: var(--primary-hover); }

        /* WORKSPACE */
        .workspace { display: flex; flex: 1; overflow: hidden; }
        .editor-container { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        #editor { flex: 1; border: none; font-size: 1.05rem; background: var(--bg-panel); color: var(--text-main); }
        
        .ql-toolbar { border: none !important; border-bottom: 1px solid var(--border) !important; background: var(--bg-panel); flex-wrap: wrap; }
        .ql-toolbar .ql-stroke { stroke: var(--text-main) !important; }
        .ql-toolbar .ql-fill { fill: var(--text-main) !important; }
        .ql-toolbar .ql-picker { color: var(--text-main) !important; }
            
        .ql-snow .ql-picker-options{background-color: var(--bg-panel)}
        .code-container { width: 40%; background: var(--code-bg); border-left: 1px solid var(--border); display: flex; flex-direction: column; }
        .code-header {
            padding: 10px 15px; background: rgba(0,0,0,0.2); color: #94a3b8;
            font-size: 0.75rem; font-weight: 600; text-transform: uppercase;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .code-btn { background: rgba(255,255,255,0.1); border: none; color: white; padding: 6px 10px; border-radius: 6px; font-size: 0.75rem; cursor: pointer; margin-left: 5px; }

        textarea#html-output {
            flex: 1; background: var(--code-bg); color: #a5b4fc;
            border: none; padding: 1.5rem; resize: none;
            font-family: 'Consolas', monospace; font-size: 13px; line-height: 1.5; white-space: pre-wrap;
        }

        .overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); z-index: 90; opacity: 0; transition: opacity 0.3s; }
        .overlay.open { display: block; opacity: 1; }

        /* RESPONSIVE */
        @media (max-width: 900px) {
            aside { position: fixed; top: 0; left: 0; height: 100%; transform: translateX(-100%); box-shadow: 4px 0 15px rgba(0,0,0,0.2); }
            aside.open { transform: translateX(0); z-index: 1000;}
            .menu-toggle { display: block; }
            .workspace { flex-direction: column; }
            .editor-container { flex: none; height: 55%; }
            .code-container { width: 100%; height: 45%; border-left: none; border-top: 1px solid var(--border); }
            .btn-save span { display: none; } .btn-save { padding: 0 12px; }
        }
        @media (max-width: 480px) {
            .ql-toolbar button { padding: 3px 5px; width: 24px; }
            .editor-container { height: 50%; } .code-container { height: 50%; }
        }

            /* Estilos específicos para el Plugin */
    .cleaner-area {
        width: 100%;
        height: 120px;
        background: var(--bg-body);
        color: var(--text-main);
        border: 1px solid var(--border);
        border-radius: 6px;
        padding: 10px;
        font-family: 'Fira Code', monospace;
        font-size: 0.85rem;
        resize: vertical;
    }
    .cleaner-area:focus { border-color: var(--primary); outline: none; }

      /* Estilos Contador de Palabras */
.word-counter {
    padding: 5px 15px;
    background: var(--bg-panel);
    border-top: 1px solid var(--border);
    font-size: 0.75rem;
    color: var(--text-muted);
    text-align: right;
    font-weight: 600;
}

/* Estilos Selector de Colores */
.color-grid {
    display: flex;
    gap: 10px;
    justify-content: center;
    padding: 10px 0;
}
.color-swatch {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 2px solid var(--border);
    cursor: pointer;
    transition: transform 0.2s;
}
.color-swatch:hover {
    transform: scale(1.1);
    border-color: var(--text-main);
}
   

    /* 1. El contenedor principal se convierte en una columna flexible que no hace scroll */
.editor-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    background: var(--bg-panel);
    height: 100%;       /* Ocupa todo el alto disponible */
    overflow: hidden;   /* IMPORTANTE: Corta el scroll general */
}

/* 2. El editor (Quill) ocupa el espacio sobrante y maneja su propio scroll */
#editor {
    border: none;
    font-size: 1rem;
    color: var(--text-main);
    flex: 1;            /* Ocupa todo el espacio entre la barra y el contador */
    overflow-y: auto;   /* AQUÍ es donde ocurre el scroll ahora */
}

/* 3. El contador se queda pegado abajo */
.word-counter {
    padding: 5px 15px;
    background: var(--bg-panel);
    border-top: 1px solid var(--border);
    font-size: 0.75rem;
    color: var(--text-muted);
    text-align: right;
    font-weight: 600;
    flex-shrink: 0;     /* Asegura que nunca se encoja ni desaparezca */
    z-index: 10;        /* Se asegura de estar por encima */
}

/* Estilo Botón Ko-fi */
.kofi-btn {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    background-color: #ff5f5f; /* Color oficial Ko-fi */
    color: white;
    text-decoration: none;
    font-weight: 700;
    padding: 12px 25px;
    border-radius: 50px;
    transition: transform 0.2s, box-shadow 0.2s;
    box-shadow: 0 4px 15px rgba(255, 95, 95, 0.3);
}

.kofi-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(255, 95, 95, 0.4);
    background-color: #ff4545;
}

.kofi-btn i { font-size: 1.2rem; }

/* --- CORRECCIÓN RESPONSIVE --- */
@media (max-width: 900px) {
    /* 1. Ocultar FORZOSAMENTE los botones de arriba */
    .top-bar .actions-right {
        display: none !important;
        width: 0 !important;
        overflow: hidden;
    }

    /* 2. Centrar el título para que se vea mejor */
    input.doc-title {
        text-align: center;
        padding-right: 0;
    }

    /* 3. Asegurar espacio para la barra de abajo */
    body {
        padding-bottom: 80px; 
    }

    /* 4. Mostrar la barra móvil */
    .mobile-nav {
        display: flex;
        /* (El resto de estilos de la barra móvil se mantienen igual) */
    }
}
    </style>
</head>
<body>

<nav class="mobile-nav">
    <button class="nav-item" onclick="toggleSidebar()" title="Archivos">
        <i class="fas fa-folder-open"></i>
        <span>Archivos</span>
    </button>
    
    <button class="nav-item" onclick="openCleaner()" title="Limpiar">
        <i class="fas fa-broom"></i>
        <span>Limpiar</span>
    </button>

    <div class="nav-fab-container">
        <button class="nav-fab" onclick="saveCurrentDraft()" title="Guardar">
            <i class="fas fa-save"></i>
        </button>
    </div>

    <button class="nav-item" onclick="openColorModal()" title="Colores">
        <i class="fas fa-palette"></i>
        <span>Estilo</span>
    </button>
    
    <button class="nav-item" onclick="toggleTheme()" title="Modo Oscuro">
        <i class="fas fa-moon"></i>
        <span>Tema</span>
    </button>
</nav>
    <div id="toast-container"></div>
    <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

    <input type="file" id="importInput" style="display: none;" accept=".json" onchange="importData(this)">

    <div class="app-wrapper">
        <aside id="sidebar">
            <div class="brand"><i class="fas fa-layer-group"></i> Redactor HTML</div>
            <button class="btn-new" onclick="createNewDraft()"><i class="fas fa-plus"></i> Nuevo</button>
            <ul class="file-list" id="fileList"></ul>

            <div class="ad-zone-container">
        <div class="ad-placeholder">
            <span>Espacio Publicitario <br> (Affiliate / Sponsor)</span>
        </div>
    </div>
            
            <div class="backup-section">
                <button class="btn-backup" onclick="exportData()" title="Descargar archivo de respaldo">
                    <i class="fas fa-cloud-download-alt"></i> Exportar
                </button>
                <button class="btn-backup" onclick="document.getElementById('importInput').click()" title="Cargar archivo de respaldo">
                    <i class="fas fa-cloud-upload-alt"></i> Restaurar
                </button>
            </div>
        </aside>

        <main>
            <div class="top-bar">
                <button class="menu-toggle" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
                <input type="text" class="doc-title" id="docTitle" placeholder="Nombre del proyecto...">
                <div class="actions-right">
                    <button class="btn-icon" onclick="openCreditsModal()" title="Apoyar el proyecto">
    <i class="fas fa-heart" style="color:#ef4444;"></i>
</button>
                    <button class="btn-icon" onclick="toggleTheme()"><i class="fas fa-moon" id="themeIcon"></i></button>
                    <button class="btn-icon" onclick="openColorModal()" title="Cambiar Color"><i class="fas fa-palette"></i></button>
                  <button class="btn-icon" onclick="openCleaner()" title="Limpiador IMG"><i class="fas fa-broom"></i></button>
                    <button class="btn-save" onclick="saveCurrentDraft()"><i class="fas fa-save"></i> <span>Guardar</span></button>
                </div>
            </div>

            <div class="workspace">
                <div class="editor-container">
                    <div id="editor"></div>
                    <div id="word-counter" class="word-counter">0 palabras</div>
                </div>
                <div class="code-container">
                    <div class="code-header">
                        <span>HTML</span>
                        <div>
                            <button class="code-btn" id="compressBtn" onclick="toggleCompression()"><i class="fas fa-compress-alt"></i></button>
                            <button class="code-btn" onclick="copyToClipboard()"><i class="far fa-copy"></i></button>
                        </div>
                    </div>
                    <textarea id="html-output" readonly></textarea>

                </div>
            </div>
        </main>
    </div>
<dialog id="colorDialog">
    <div class="dialog-header">
        <h3><i class="fas fa-brush" style="color:var(--primary)"></i> Color de Acento</h3>
        <button onclick="closeColorModal()" class="close-icon"><i class="fas fa-times"></i></button>
    </div>
    <div class="dialog-body">
        <p style="font-size:0.9rem; color:var(--text-muted); margin-bottom:15px;">Elige el color principal de la interfaz:</p>
        <div class="color-grid">
            <button class="color-swatch" style="background:#2563eb" onclick="setAppColor('#2563eb')"></button> <button class="color-swatch" style="background:#7c3aed" onclick="setAppColor('#7c3aed')"></button> <button class="color-swatch" style="background:#db2777" onclick="setAppColor('#db2777')"></button> <button class="color-swatch" style="background:#ea580c" onclick="setAppColor('#ea580c')"></button> <button class="color-swatch" style="background:#059669" onclick="setAppColor('#059669')"></button> <button class="color-swatch" style="background:#000000" onclick="setAppColor('#000000')"></button> </div>
    </div>
</dialog>

<dialog id="creditsModal">
    <div class="dialog-header">
        <h3><i class="fas fa-mug-hot" style="color:var(--primary)"></i> Redactor Pro</h3>
        <button onclick="closeCreditsModal()" class="close-icon"><i class="fas fa-times"></i></button>
    </div>
    <div class="dialog-body" style="text-align: center;">
        <p style="font-size:1.1rem; font-weight:600; margin-bottom:5px;">Version v1.0.0</p>
        <p style="color:var(--text-muted); font-size:0.9rem; margin-bottom:20px;">
            Desarrollado para crear contenido limpio y semántico.
        </p>

        <a href="https://ko-fi.com/TU_USUARIO_AQUI" target="_blank" class="kofi-btn">
            <i class="fas fa-coffee"></i> Invítame un Café en Ko-fi
        </a>

        <p style="font-size:0.8rem; color:var(--text-muted); margin-top:20px;">
            Hecho con <i class="fas fa-heart" style="color:#ef4444"></i> por Framber Silva
        </p>
    </div>
</dialog>

<dialog id="cleanerDialog">
    <div class="dialog-header">
        <h3><i class="fas fa-magic" style="color:var(--accent)"></i> Limpiador de Imágenes</h3>
        <button onclick="closeCleaner()" class="close-icon"><i class="fas fa-times"></i></button>
    </div>
    
    <div class="dialog-body">
        <label>Pega el código sucio de Blogger:</label>
        <textarea id="dirtyInput" class="cleaner-area" placeholder='<div class="separator"><a href...><img...></a></div>'></textarea>
        
        <div style="display:flex; gap:10px; margin: 5px 0;">
            <button onclick="processCleaner()" class="btn-process" style="flex:1">
                <i class="fas fa-arrow-down"></i> Procesar y Limpiar
            </button>
            <button onclick="clearCleanerFields()" class="btn-clear" title="Borrar todo">
                <i class="fas fa-trash-alt"></i>
            </button>
        </div>

        <label>Resultado limpio:</label>
        <textarea id="cleanOutput" class="cleaner-area" readonly></textarea>
    </div>

    <div class="dialog-footer">
        <button class="m-btn m-cncl" onclick="closeCleaner()">Cerrar</button>
        <button class="m-btn m-ok" onclick="copyCleanCode()">Copiar Resultado</button>
    </div>
</dialog>
<style>
    /* Estilos del Dialog Nativo */
    dialog {
        border: none;
        border-radius: 12px;
        padding: 0;
        background: var(--bg-panel);
        color: var(--text-main);
        box-shadow: 0 15px 30px rgba(0,0,0,0.3);
        max-width: 600px;
        width: 90%;
    }
    dialog::backdrop {
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(3px);
    }
    
    .dialog-header {
        padding: 15px 20px;
        border-bottom: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .dialog-header h3 { margin: 0; font-size: 1.1rem; }
    .close-icon { background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 1.1rem; }
    
    .dialog-body { padding: 20px; display: flex; flex-direction: column; gap: 10px; }
    .dialog-body label { font-size: 0.85rem; font-weight: 600; color: var(--text-muted); }
    
    .dialog-footer { padding: 15px 20px; background: var(--bg-body); border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 10px; }

    .cleaner-area {
        width: 100%; height: 100px; background: var(--bg-body); color: var(--text-main);
        border: 1px solid var(--border); border-radius: 6px; padding: 10px;
        font-family: 'Fira Code', monospace; font-size: 0.8rem; resize: vertical;
    }
    .btn-process {
        width: 100%; padding: 10px; background: var(--primary-soft); color: var(--accent);
        border: 1px solid var(--accent); border-radius: 6px; font-weight: 600; cursor: pointer;
        transition: 0.2s;
    }
    .btn-process:hover { background: var(--accent); color: white; }

    .btn-clear {
    background: transparent;
    border: 1px solid var(--danger);
    color: var(--danger);
    border-radius: 6px;
    padding: 0 15px;
    cursor: pointer;
    font-size: 1rem;
    transition: 0.2s;
}
.btn-clear:hover {
    background: var(--danger);
    color: white;
}
</style>

    

    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script>
        // --- TOASTS ---
        function showNotification(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            let icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';
            toast.className = `toast ${type}`;
            toast.innerHTML = `<i class="fas ${icon}"></i> <span>${message}</span>`;
            container.appendChild(toast);
            setTimeout(() => {
                toast.style.animation = 'fadeOut 0.3s ease forwards';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // --- THEME ---
        const themeIcon = document.getElementById('themeIcon');
        function initTheme() {
            if (localStorage.getItem('theme') === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                themeIcon.classList.replace('fa-moon', 'fa-sun');
            }
        }
        function toggleTheme() {
            if (document.documentElement.getAttribute('data-theme') === 'dark') {
                document.documentElement.removeAttribute('data-theme');
                localStorage.setItem('theme', 'light');
                themeIcon.classList.replace('fa-sun', 'fa-moon');
                showNotification('Modo Claro');
            } else {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
                themeIcon.classList.replace('fa-moon', 'fa-sun');
                showNotification('Modo Oscuro');
            }
        }
        initTheme();

        // --- BACKUP SYSTEM (EXPORT/IMPORT) ---
        function exportData() {
            const data = localStorage.getItem('webcrafter_final_db');
            if (!data || data === '[]') {
                showNotification('No hay datos para exportar', 'error');
                return;
            }
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `webcrafter_backup_${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showNotification('Copia de seguridad descargada');
        }

        function importData(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const json = JSON.parse(e.target.result);
                    if (Array.isArray(json)) {
                        localStorage.setItem('webcrafter_final_db', JSON.stringify(json));
                        renderSidebar();
                        createNewDraft(); // Reset view
                        showNotification('Datos restaurados correctamente');
                    } else {
                        throw new Error('Formato inválido');
                    }
                } catch (error) {
                    showNotification('Error: Archivo inválido', 'error');
                }
            };
            reader.readAsText(file);
            input.value = ''; // Reset input
        }

        // --- SIDEBAR ---
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
            document.getElementById('overlay').classList.toggle('open');
        }

        // --- QUILL EDITOR ---
        const toolbarOptions = [
            [{ 'header': [1, 2, false] }],
            ['bold', 'italic', 'underline', 'blockquote'],
            [{ 'list': 'ordered'}, { 'list': 'bullet' }],
            ['link', 'image', 'video'],
            ['clean']
        ];
        const quill = new Quill('#editor', {
            theme: 'snow',
            modules: { toolbar: toolbarOptions },
            placeholder: 'Escribe aquí...'
        });

        const htmlOutput = document.getElementById('html-output');
        const docTitleInput = document.getElementById('docTitle');
        let currentDraftId = null;
        let isCompressed = false;

        function prettierHTML(html) {
            const blockTags = ['p', 'h1', 'h2', 'h3', 'ul', 'ol', 'li', 'blockquote', 'div', 'iframe', 'figure'];
            let formatted = html;
            blockTags.forEach(tag => {
                formatted = formatted.replace(new RegExp(`<${tag}`, 'g'), `\n<${tag}`);
                formatted = formatted.replace(new RegExp(`<\/${tag}>`, 'g'), `<\/${tag}>\n`);
            });
            return formatted.replace(/\n\s*\n/g, '\n').trim();
        }

        function updateOutput() {
            let html = quill.root.innerHTML;
            html = html.replace(/<p><br><\/p>/g, "");
            if (html === "<br>") html = "";
            if (!isCompressed && html !== "") {
                html = prettierHTML(html);
            } else if (isCompressed) {
                html = html.replace(/\n/g, '');
            }
            htmlOutput.value = html;
        }
        quill.on('text-change', updateOutput);

        function toggleCompression() {
            isCompressed = !isCompressed;
            const btn = document.getElementById('compressBtn');
            btn.innerHTML = isCompressed ? '<i class="fas fa-expand-alt"></i>' : '<i class="fas fa-compress-alt"></i>';
            showNotification(isCompressed ? 'Comprimido' : 'Expandido');
            updateOutput();
        }

        // --- STORAGE ---
        function getDrafts() {
            const data = localStorage.getItem('webcrafter_final_db');
            return data ? JSON.parse(data) : [];
        }
        function saveDrafts(data) {
            localStorage.setItem('webcrafter_final_db', JSON.stringify(data));
            renderSidebar();
        }

        function createNewDraft() {
            currentDraftId = Date.now();
            docTitleInput.value = '';
            quill.root.innerHTML = '';
            if(window.innerWidth < 900 && document.getElementById('sidebar').classList.contains('open')) toggleSidebar();
            docTitleInput.focus();
            renderSidebar();
            showNotification('Nuevo borrador');
        }

        function saveCurrentDraft() {
            const title = docTitleInput.value.trim() || 'Sin Título';
            const content = quill.root.innerHTML;
            let drafts = getDrafts();
            if (!currentDraftId) currentDraftId = Date.now();
            const idx = drafts.findIndex(d => d.id === currentDraftId);
            const draft = { id: currentDraftId, title, content, date: new Date().toLocaleDateString() };
            if (idx >= 0) drafts[idx] = draft; else drafts.unshift(draft);
            saveDrafts(drafts);
            showNotification('Guardado');
        }

        function loadDraft(id) {
            const draft = getDrafts().find(d => d.id === id);
            if (draft) {
                currentDraftId = draft.id;
                docTitleInput.value = draft.title;
                quill.clipboard.dangerouslyPasteHTML(draft.content);
                if(window.innerWidth < 900) toggleSidebar();
                renderSidebar();
            }
        }

        function deleteDraft(id, e) {
            e.stopPropagation();
            if(confirm('¿Eliminar?')) {
                const drafts = getDrafts().filter(d => d.id !== id);
                saveDrafts(drafts);
                if (currentDraftId === id) createNewDraft();
                showNotification('Eliminado', 'error');
            }
        }

        function renderSidebar() {
            const list = document.getElementById('fileList');
            list.innerHTML = '';
            getDrafts().forEach(d => {
                const li = document.createElement('li');
                li.className = `file-item ${d.id === currentDraftId ? 'active' : ''}`;
                li.onclick = () => loadDraft(d.id);
                li.innerHTML = `
                    <div class="file-info"><strong>${d.title}</strong><small>${d.date}</small></div>
                    <button class="delete-btn" onclick="deleteDraft(${d.id}, event)"><i class="fas fa-trash"></i></button>
                `;
                list.appendChild(li);
            });
        }

        function copyToClipboard() {
            htmlOutput.select();
            document.execCommand('copy');
            showNotification('Copiado al portapapeles');
        }

        renderSidebar();
        if (getDrafts().length === 0) createNewDraft();

    </script>

    <script>
   // --- LÓGICA DIALOG CLEANER ---

const cleanerDialog = document.getElementById('cleanerDialog');

function openCleaner() {
    // showModal() es el método nativo que abre el dialog y bloquea el fondo
    cleanerDialog.showModal();
    document.getElementById('dirtyInput').focus();
}

function closeCleaner() {
    cleanerDialog.close();
}

// Cerrar si se hace clic fuera del contenido (en el backdrop)
cleanerDialog.addEventListener('click', (event) => {
    if (event.target === cleanerDialog) {
        cleanerDialog.close();
    }
});

function processCleaner() {
    const raw = document.getElementById('dirtyInput').value;
    if (!raw.trim()) return toast("El campo está vacío", "error");

    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = raw;
    
    const images = tempDiv.querySelectorAll('img');
    let cleanCode = '';

    if (images.length === 0) {
        toast("No encontré imágenes", "error");
        return;
    }

    images.forEach(img => {
        const src = img.getAttribute('src');
        const alt = img.getAttribute('alt') || '';
        // Generamos img limpia con lazy loading
        cleanCode += `<img src="${src}" alt="${alt}" loading="lazy" />\n\n`;
    });

    document.getElementById('cleanOutput').value = cleanCode.trim();
}

function copyCleanCode() {
    const output = document.getElementById('cleanOutput');
    if (!output.value) return;
    output.select();
    document.execCommand('copy');
    toast("Código limpio copiado");
    closeCleaner();
}

function clearCleanerFields() {
    document.getElementById('dirtyInput').value = '';
    document.getElementById('cleanOutput').value = '';
    document.getElementById('dirtyInput').focus();
    // Opcional: Feedback visual
    const btn = event.currentTarget;
    btn.innerHTML = '<i class="fas fa-check"></i>';
    setTimeout(() => btn.innerHTML = '<i class="fas fa-trash-alt"></i>', 1000);
}
    </script>

    <script>
        // --- 1. LÓGICA CONTADOR DE PALABRAS ---
quill.on('text-change', function() {
    let text = quill.getText();
    // Eliminar espacios vacíos y contar
    let count = text.trim().length === 0 ? 0 : text.trim().split(/\s+/).length;
    document.getElementById('word-counter').innerText = count + ' palabras';
    
    // (Opcional) Llamar a updateOutput() aquí si no está automático
    updateOutput();
});

// --- 2. LÓGICA CAMBIADOR DE COLOR ---
const colorDialog = document.getElementById('colorDialog');

function openColorModal() {
    colorDialog.showModal();
}

function closeColorModal() {
    colorDialog.close();
}

function setAppColor(color) {
    // Cambiar la variable CSS --primary dinámicamente
    document.documentElement.style.setProperty('--primary', color);
    
    // Guardar preferencia
    localStorage.setItem('wc_accent_color', color);
    
    // Efecto visual y cerrar
    closeColorModal();
}

// Cargar color guardado al iniciar
const savedColor = localStorage.getItem('wc_accent_color');
if (savedColor) {
    document.documentElement.style.setProperty('--primary', savedColor);
}

// Cerrar al hacer clic fuera (Backdrop)
colorDialog.addEventListener('click', (event) => {
    if (event.target === colorDialog) colorDialog.close();
});


// --- LÓGICA MODAL CRÉDITOS ---
const creditsModal = document.getElementById('creditsModal');

function openCreditsModal() {
    creditsModal.showModal();
}

function closeCreditsModal() {
    creditsModal.close();
}

// Cerrar al hacer clic fuera
creditsModal.addEventListener('click', (event) => {
    if (event.target === creditsModal) creditsModal.close();
});
    </script>


</body>
</html>
